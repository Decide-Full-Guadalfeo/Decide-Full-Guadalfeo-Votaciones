dist: xenial
services:
- postgresql
addons:
  postgresql: '9.4'
before_script:
- psql -U postgres -c "create user decide password 'decide'"
- psql -U postgres -c "create database test_decide owner decide"
- psql -U postgres -c "ALTER USER decide CREATEDB"
language: python
python:
- '3.6'
install:
- pip install -r requirements.txt
- pip install codacy-coverage
script:
- cd decide
- cp travis_local_settings.py local_settings.py
- coverage run --branch --source=. ./manage.py test --keepdb --with-xunit
- coverage xml
- python-codacy-coverage -r coverage.xml
deploy:
  provider: heroku
  app: guadalfeo-votaciones-prod
  strategy: git
  api_key:
    secure: pxH6ZSI7tws4Zr9IsLABYm/wFsgFpTHJD96T/w8uiCRy2CoBzbgXgtlr1CDLnBA0PPFpwyPRyQ/3BMbCbc+WvXBbukEGK5UBdpC16CmFSn8su4CFm1iDkwlOvpredrw1rY7ynDAaOgUqTJHJLKyRxVN2u7xLY0RqL8/snRzeJq8mYILnFWgoEyp2Wv8Hfoi8yvbetW9CyUixYgZKXL9VRQdLrKc32l8pD3pb7cvJDJr1AgGwJ+ZsgUQXb9d4cJu6s4RyIXLUq1qvWEkqLc9GsyJcRZMhJJby2t7+EFG6DY5/0pX0UYogwX5G18HjZLGEoDVY2iLtXlAcb0HDU9EEtyvGg/VYpsMqNGaDt1gxIT66NI+oT+zR64ai7tPAvSMf5BUy34SOZ6XcsmMkTFuS+UzObeKBmhwzgK/i9A/ds+b6kYKq6pyCf0NgJQH90KzMR6vHnRip36JeMJl7CiKJb2gX8V3kRVzgVE6Vxok8re7/WDSPavWtmJoBoR6KPcQ6LEjo5gBTMs1gJxQAPvtnrcLWAJdg+Y7vhSJVLSJ11x3LOf+qwFZRA58rFLBwq6sSrdQDOvk1lbk0jPlHb9HY9erAOA0n6S07em7Qx3orGShXkrCu1tGGRD5fQ7fc1+FGr6KAkaVqrkyXGkdsA+NhpzXNIP6Wc5Wu/KehtBAQidI=
  on:
    branch: master
